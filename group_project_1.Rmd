---
title: "Statistical Inference Group Project"
author: "Dimitri Angelov, Jeeda AbuKhader, Simona Rahi"
date: "12/7/2019"
output: 
    html_document:
         code_folding: hide
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r message=FALSE, warning=FALSE}
library(tidyverse)
library(pastecs)
library(ggplot2)
library(corrplot)
library(pastecs)
library(Hmisc)
library(ggpubr)
library(PerformanceAnalytics)
library(data.table)
library(GGally)
```

```{r}
#Import data set
human_freedom_index <- ("~/working/data_science_folders/statistical_inference_data_science_I/project_stats/project_group_stats/hfi_cc_2018.csv")

#Have the variables read in as factors to make the interpretation easier to understand
human_freedom_read <- fread(human_freedom_index)
human_freedom_read[,1:4] <- lapply(human_freedom_read[,1:4], as.factor)

#Only use the year 2016
human_freedom <- subset(human_freedom_read, year == 2016)
dim(human_freedom)
freedom_2016 <- subset(human_freedom, year == 2016 )
View(human_freedom)
```

```{r}
#Distribution of variables
variable_stats <- human_freedom %>%
  select(pf_rol_criminal, pf_ss_homicide, pf_movement, pf_religion, pf_identity, pf_score, pf_rank, hf_score, hf_rank) %>%
  na.omit()
summary(variable_stats)
```

```{r}
#Create personal freedom index
personal_freedom_score <- human_freedom %>%
  select(year, ISO_code, countries, region, pf_score, pf_rank, hf_score, hf_rank) %>% 
  na.omit()
names(personal_freedom_score)
```

```{r}
#Create matrix table for personal freedom index
personal_freedom_score %>%
  ggcorr(label = T, low = "#3B9AB2", high = "#F21A00", name = "Legend")
```

```{r}
#Create a religious freedom index
religious_freedom <- human_freedom %>%
  select(year, ISO_code, countries, region, pf_religion, hf_score, hf_rank) %>%
  na.omit()
```

```{r}
#Now create a correlation matrix between these indexes
matrix_correlation_religion_personal <- human_freedom %>%
  select(pf_religion, pf_score, pf_rank, hf_score, hf_rank) 
matrix_correlation_religion_personal %>% 
  ggcorr(label = T, low = "#3B9AB2", high = "#F21A00", name = "Legend")
```

```{r}
#Create a categorical variable from personal freedom rank for low, medium, and high freedom levels
#Freedom levels for 2016
freedom_levels_2016 <- cut(freedom_2016$pf_score, c(0, 3.5, 7.5, 10))
levels(freedom_levels_2016) <- c("Low Freedom", "Medium Freedom", "High Freedom")
low_freedom_2016 <- subset(freedom_2016, freedom_levels_2016 == "Low Freedom")
med_freedom_2016 <- subset(freedom_2016, freedom_levels_2016 == "Medium Freedom")
high_freedom_2016 <- subset(freedom_2016, freedom_levels_2016 == "High Freedom")
```

```{r}
#Number 2
#Checking assumption of normality with a histogram
histogram(freedom_2016$pf_score)
```

```{r}
#Now check with a boxplot
boxplot(freedom_2016$pf_score)
```

```{r}
#Checking wich countries are outliers
freedom_2016 %>%
  select(countries, pf_score) %>%
  filter(pf_score < 3)

#Removing outliers
new_freedom_2016 <- freedom_2016[-which(freedom_2016$pf_score < 3),]
```

```{r}
#Running the t-test
t.test(new_freedom_2016$pf_score, mu=7.5)
Cohen <- abs(mean(new_freedom_2016$pf_score)-7.5)/sd(new_freedom_2016$pf_score)
```

```{r}
#Number 3
#Hypothesis Test
x <- nrow(high_freedom_2016)
n <- sum(nrow(low_freedom_2016),nrow(med_freedom_2016), nrow(high_freedom_2016))
prop.test(x, n, p = 0.5, correct = FALSE)
```

```{r}
#Number 4
freedom_MENA <- subset(freedom_2016, freedom_2016$region == "Middle East & North Africa")
freedom_latin_america <- subset(freedom_2016, freedom_2016$region == "Latin America & the Caribbean")
df <- freedom_2016 %>%
  filter(region == "Middle East & North Africa" | region == "Latin America & the Caribbean")
```

```{r}
#Checking for assumptions
#Check histogram for Middle East
hist(freedom_MENA$pf_religion)
```

```{r}
#Check boxplot for Middle East
boxplot(freedom_MENA$pf_religion, main = "MENA")
```

```{r}
#Check histogram for Latin America
hist(freedom_latin_america$pf_religion)
```

```{r}
#Check boxplot for Latin America
boxplot(freedom_latin_america$pf_religion, main = "Latin America & Caribbean")
```

```{r}
#Two-sample t-test
t.test(pf_religion ~ region, data = df)

#Cohen's d
mean1 <- mean(freedom_latin_america$pf_religion, na.rm = T)
mean2 <- mean(freedom_MENA$pf_religion, na.rm = T)
sd1 <- sd(freedom_latin_america$pf_religion)
sd2 <- sd(freedom_MENA$pf_religion, na.rm = T)
cohen_d <- abs(mean1 - mean2)/sqrt((sd1^2 + sd2^2)/2)
cohen_d
```

```{r}
#Number 5a
#Create a multiple linear regression line using our explanatory variables pf_rol_criminal, pf_ss_homicide, pf_movement, pf_religion, pf_identity against our response variable pf_score

#Model for pf_rol_criminal
criminal_model <- with(human_freedom,pf_score ~ pf_rol_criminal)
lm_criminal <- lm(formula = criminal_model, data = human_freedom)
summary(lm_criminal)
deviance(lm_criminal)
```

```{r}
#Pearson correlation test for pf_rol_criminal
cor.test(human_freedom$pf_score, human_freedom$pf_rol_criminal, method = "pearson")
```

```{r}
#Create a histogram for pf_rol_criminal
hist(lm_criminal$residuals)
```

```{r}
#Create a scatterplot for pf_rol_criminal
ggscatter(human_freedom, x = "pf_rol_criminal", y = "pf_score", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Criminal Justice (score)", ylab = "Personal Freedom (score)")
```

```{r}
#Model for pf_ss_homicide
homocide_model <- with(human_freedom,pf_score ~ pf_ss_homicide)
lm_homicide <- lm(formula = homocide_model, data = human_freedom)
summary(lm_homicide)
deviance(lm_homicide)
```

```{r}
#Pearson correlation test for pf_ss_homicide
cor.test(human_freedom$pf_score, human_freedom$pf_ss_homicide, method = "pearson")
```

```{r}
#Create a histogram for pf_ss_homicide
hist(lm_homicide$residuals)
```

```{r}
#Create a scatterplot for pf_ss_homicide
ggscatter(human_freedom, x = "pf_ss_homicide", y = "pf_score", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Homicide (score)", ylab = "Personal Freedom (score)")
```

```{r}
#Model for pf_movement
movement_model <- with(human_freedom,pf_score ~ pf_movement)
lm_movement <- lm(formula = movement_model, data = human_freedom)
summary(lm_movement)
deviance(lm_movement)
```

```{r}
#Pearson correlation test for pf_movement
cor.test(human_freedom$pf_score, human_freedom$pf_movement, method = "pearson")
```

```{r}
#Create a histogram for pf_movement
hist(lm_movement$residuals)
```

```{r}
#Create a scatterplot for pf_movement
ggscatter(human_freedom, x = "pf_movement", y = "pf_score", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Freedom of Movement (score)", ylab = "Personal Freedom (score)")
```

```{r}
#Model for pf_religion
religion_model <- with(human_freedom,pf_score ~ pf_religion)
lm_religion <- lm(formula = religion_model, data = human_freedom)
summary(lm_religion)
deviance(lm_religion)
```

```{r}
#Pearson correlation test for pf_religion
cor.test(human_freedom$pf_score, human_freedom$pf_religion, method = "pearson")
```

```{r}
#Create a histogram for pf_religion
hist(lm_religion$residuals)
```

```{r}
#Create a scatterplot for pf_religion
ggscatter(human_freedom, x = "pf_religion", y = "pf_score", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Freedom of Religion
 (score)", ylab = "Personal Freedom (score)")
```

```{r}
#Model for pf_identity
identity_model <- with(human_freedom,pf_score ~ pf_identity)
lm_identity <- lm(formula = identity_model, data = human_freedom)
summary(lm_identity)
deviance(lm_identity)
```

```{r}
#Pearson correlation test for pf_identity
cor.test(human_freedom$pf_score, human_freedom$pf_identity, method = "pearson")
```

```{r}
#Create a histogram for pf_identity
hist(lm_identity$residuals)
```

```{r}
#Create a scatterplot for pf_identity
ggscatter(human_freedom, x = "pf_identity", y = "pf_score", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "Freedom of Identity and Relationships
 (score)", ylab = "Personal Freedom (score)")
```

```{r}
#Now to create a multiple linear model for all the variables
multiple_model <- with(human_freedom,pf_score ~ pf_rol_criminal + pf_ss_homicide + pf_movement + pf_religion + pf_identity)
lm_multiple <- lm(formula = multiple_model, data = human_freedom)
summary(lm_multiple)
deviance(lm_multiple)
```

```{r}
#Create a histogram of the multiple linear regression model
hist(lm_multiple$residuals)
```

```{r}
#Create a correlation matrix to see which variables are the most related to each other
matrix_correlation_multiple <- human_freedom %>%
  select(pf_score, pf_rol_criminal, pf_ss_homicide, pf_movement, pf_religion, pf_identity)

#Create matrix table
matrix_correlation_multiple %>%
  ggcorr(label = T, low = "#3B9AB2", high = "#F21A00", name = "Legend")
```
